<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brawl Stars Draft Assistant - V10 Tri Avancé</title>
    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --pick-enemy: #ff9900;
            --pick-ally: #0099ff;
            --text-color: #ffffff;
            
            /* COULEURS ETATS */
            --col-ideal: #ffd700; /* Or (Dominant) */
            --col-good: #00ff88;  /* Vert (Positif) */
            --col-mixed: #3399ff; /* Bleu (Neutre/Trade) */
            --col-bad: #ff3333;   /* Rouge (Négatif) */
            --col-fatal: #a000c0; /* Violet (Mortel) */
            --col-ban: #ff4444;   /* Rouge pâle (Banni) */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
        }

        /* HEADER */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .controls { display: flex; gap: 10px; }
        button { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px; }
        .btn-reset { background: var(--col-ban); color: white; }
        .btn-undo { background: #444; color: white; }
        
        #btn-fp { transition: 0.3s; color: white; border: 1px solid rgba(255,255,255,0.2); }
        .fp-ally { background: var(--pick-ally); box-shadow: 0 0 10px rgba(0, 153, 255, 0.4); }
        .fp-enemy { background: var(--pick-enemy); box-shadow: 0 0 10px rgba(255, 153, 0, 0.4); }

        /* LÉGENDE */
        .legend { font-size: 11px; display: flex; gap: 12px; color: #aaa; align-items: center; flex-wrap: wrap; }
        .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 4px; }

        /* BANS */
        .bans-container { display: flex; gap: 8px; background: var(--panel-bg); padding: 8px; border-radius: 8px; border: 1px solid #333; }
        .ban-slot {
            width: 50px; height: 50px; background: #333; border: 2px solid #555; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; cursor: pointer; overflow: hidden; position: relative;
        }
        .ban-slot.active { border-color: var(--col-ban); box-shadow: 0 0 8px var(--col-ban); }
        .ban-slot img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; filter: grayscale(100%); }
        .ban-icon-overlay { position: absolute; font-size: 24px; color: var(--col-ban); font-weight: bold; pointer-events: none; }

        /* ZONES */
        .draft-area { display: flex; flex: 1; gap: 15px; overflow: hidden; }
        .team-panel { width: 140px; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0; }
        
        .pick-slot {
            height: 90px; background: var(--panel-bg); border: 2px solid #444; border-radius: 10px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: hidden; transition: 0.2s;
        }
        .pick-slot img { width: 100%; height: 100%; object-fit: cover; }
        .pick-slot span { position: absolute; bottom: 4px; background: rgba(0,0,0,0.8); padding: 2px 6px; font-size: 11px; border-radius: 4px; pointer-events: none; }
        
        .pick-slot.enemy.active { border-color: var(--pick-enemy); box-shadow: 0 0 15px var(--pick-enemy); transform: scale(1.02); }
        .pick-slot.ally.active { border-color: var(--pick-ally); box-shadow: 0 0 15px var(--pick-ally); transform: scale(1.02); }

        /* GRILLE */
        .grid-container {
            flex: 1; background: var(--panel-bg); border-radius: 12px; padding: 15px;
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }
        .search-bar {
            width: 100%; padding: 10px; background: #121212; border: 1px solid #444; color: white;
            margin-bottom: 10px; border-radius: 6px; font-size: 14px; box-sizing: border-box;
        }
        .brawlers-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(95px, 1fr)); gap: 8px;
            overflow-y: auto; padding-right: 5px;
        }

        /* CARTES */
        .brawler-card {
            background: #2a2a2a; border-radius: 8px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; padding: 6px;
            border: 2px solid transparent; position: relative; height: 115px;
            transition: transform 0.1s;
        }
        .brawler-card:hover { transform: scale(1.05); z-index: 10; background: #333; }
        .brawler-card > img { width: 60px; height: 60px; object-fit: contain; border-radius: 4px; margin-bottom: 28px; }
        .brawler-card .name { font-size: 10px; text-align: center; position: absolute; bottom: 5px; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600; }
        .img-error-text { font-size: 8px; color: #ff6b6b; margin-top: 2px; text-align: center; line-height: 1; }

        /* --- LOGIQUE DE TRI VISUEL (CSS Order) --- */
        
        /* 1. IDEAL (Or) : Score net >= 2, 0 menace */
        .brawler-card.status-ideal { 
            border-color: var(--col-ideal); background: rgba(255, 215, 0, 0.15); 
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); order: -10; 
        }
        
        /* 2. GOOD SAFE (Vert) : Score net > 0, 0 menace */
        .brawler-card.status-good { 
            border-color: var(--col-good); background: rgba(0, 255, 136, 0.1); 
            order: -5; 
        }

        /* 3. GOOD RISKY (Vert) : Score net > 0, MAIS avec menaces */
        /* C'est ton cas "contre 2, contré par 1". Il reste vert mais descend dans la liste */
        .brawler-card.status-good-risky { 
            border-color: var(--col-good); background: rgba(0, 255, 136, 0.1); 
            /* Ajout d'un petit effet visuel pour signaler le risque si tu veux, sinon juste vert */
            border-style: dashed; 
            order: -3; 
        }

        /* 4. MIXED (Bleu) : Score net = 0 (Trade) */
        .brawler-card.status-mixed { 
            border-color: var(--col-mixed); background: rgba(51, 153, 255, 0.15); 
            order: -1; 
        }

        /* 5. BAD (Rouge) : Score net < 0 (-1) */
        .brawler-card.status-bad { 
            border-color: var(--col-bad); background: rgba(255, 51, 51, 0.15); 
            opacity: 0.9; order: 10;
        }

        /* 6. FATAL (Violet) : Score net très bas (<= -2) */
        .brawler-card.status-fatal { 
            border-color: var(--col-fatal); background: rgba(160, 0, 192, 0.2); 
            opacity: 0.7; order: 20;
        }
        
        /* Disabled */
        .brawler-card.disabled { opacity: 0.2; filter: grayscale(100%); pointer-events: none; order: 999; }
        .brawler-card.banned::after { content: 'X'; position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; color: red; font-weight: bold; text-shadow: 0 0 5px black; }

        /* MINI ICONES */
        .interactions-container {
            position: absolute; top: 62px; width: 100%; display: flex; justify-content: space-between; padding: 0 4px; box-sizing: border-box; pointer-events: none;
        }
        .mini-icon-group { display: flex; gap: -2px; /* Chevauchement léger pour gagner de la place */ }
        
        .mini-icon {
            width: 24px; height: 24px; object-fit: cover; border-radius: 50%;
            border: 1px solid white; background: #000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.8);
            z-index: 2; /* Pour le chevauchement */
        }
        
        .mini-icon.victim { border-color: var(--col-good); }
        .mini-icon.killer { border-color: var(--col-bad); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e1e1e; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="controls">
            <button class="btn-reset" onclick="resetDraft()">RESET</button>
            <button class="btn-undo" onclick="clearCurrentSlot()">EFFACER</button>
            <button id="btn-fp" class="fp-ally" onclick="toggleFirstPick()">1st PICK: MOI</button>
        </div>
        
        <div class="legend">
            <span><div class="dot" style="background:var(--col-ideal)"></div>Idéal</span>
            <span><div class="dot" style="background:var(--col-good)"></div>Sûr</span>
            <span style="border-bottom: 1px dashed var(--col-good)">Risqué (Vert)</span>
            <span><div class="dot" style="background:var(--col-mixed)"></div>Mitigé</span>
            <span><div class="dot" style="background:var(--col-bad)"></div>Négatif</span>
            <span><div class="dot" style="background:var(--col-fatal)"></div>Mortel</span>
        </div>

        <div class="bans-container">
            <div class="ban-slot" onclick="selectSlot(this, 'ban', 0)"></div>
            <div class="ban-slot" onclick="selectSlot(this, 'ban', 1)"></div>
            <div class="ban-slot" onclick="selectSlot(this, 'ban', 2)"></div>
            <div class="ban-slot" onclick="selectSlot(this, 'ban', 3)"></div>
            <div class="ban-slot" onclick="selectSlot(this, 'ban', 4)"></div>
            <div class="ban-slot" onclick="selectSlot(this, 'ban', 5)"></div>
        </div>
    </div>

    <div class="draft-area">
        <div class="team-panel">
            <h3 style="color: var(--pick-enemy); text-align: center; font-size:14px; margin-bottom:5px;">ADVERSAIRES</h3>
            <div class="pick-slot enemy" onclick="selectSlot(this, 'enemy', 0)"><span>Pick 1</span></div>
            <div class="pick-slot enemy" onclick="selectSlot(this, 'enemy', 1)"><span>Pick 2</span></div>
            <div class="pick-slot enemy" onclick="selectSlot(this, 'enemy', 2)"><span>Pick 3</span></div>
        </div>

        <div class="grid-container">
            <input type="text" id="searchInput" class="search-bar" placeholder="Chercher un brawler..." onkeyup="filterGrid()">
            <div class="brawlers-grid" id="grid"></div>
        </div>

        <div class="team-panel">
            <h3 style="color: var(--pick-ally); text-align: center; font-size:14px; margin-bottom:5px;">MON ÉQUIPE</h3>
            <div class="pick-slot ally" onclick="selectSlot(this, 'ally', 0)"><span>Pick 1</span></div>
            <div class="pick-slot ally" onclick="selectSlot(this, 'ally', 1)"><span>Pick 2</span></div>
            <div class="pick-slot ally" onclick="selectSlot(this, 'ally', 2)"><span>Pick 3</span></div>
        </div>
    </div>

    <script>
        // --- DONNEES ---
        const rawData = {
            "8-BIT": ["Belle", "Squeak", "Penny", "Barley", "Sprout", "Bo", "Mina"],
            "ALLI": ["Doug", "Trunk", "Bull", "R-T", "Jacky"],
            "AMBER": ["Crow", "Belle", "Lily", "Byron", "Sprout"],
            "ANGELO": ["Gray", "Max", "Nani", "Eve", "Darryl"],
            "ASH": ["Frank", "Trunk", "Otis", "Mina", "Carl", "Emz"],
            "BARLEY": ["Sprout", "Tick", "Griff", "Kaze", "Lily", "Carl", "Stu", "Brock"],
            "BEA": ["Brock", "Belle", "Sprout", "Bo", "Gus"],
            "BELLE": ["Piper", "Byron", "Nani", "Sprout", "Mandy"],
            "BERRY": ["Barley", "Frank", "Griff", "Kaze", "Dynamike"],
            "BIBI": ["Bea", "Lumi", "Ash", "Bull", "Griff"],
            "BO": ["Kaze", "Lily", "Stu", "Piper", "Kenji"],
            "BONNIE": ["Nani", "Piper", "Brock", "Charlie", "Angelo", "Tick"],
            "BROCK": ["Piper", "Angelo", "Nani", "Mandy", "Jae-yong", "Max", "Darryl", "Kaze", "Ollie"],
            "BULL": ["Tara", "Cordelius", "Charlie", "Willow", "Griff"],
            "BUSTER": ["Ash", "Brock", "Squeak", "Trunk", "Willow", "Barley"],
            "BUZZ": ["Bull", "Doug", "Gene", "Finx", "Stu", "Meeple", "Cordelius"],
            "BYRON": ["Piper", "Nani", "Sprout", "Tick", "Poco", "Kaze", "Lily"],
            "CARL": ["Stu", "Darryl", "Buster", "Colette", "Crow", "Gus", "Buzz"],
            "CHARLIE": ["Squeak", "Byron", "Brock", "Angelo", "Amber", "Sprout", "Tick", "Willow", "Penny", "Jae-yong"],
            "CHESTER": ["Squeak", "Carl", "Crow", "Byron", "Belle", "Sprout", "Barley", "Willow"],
            "CHUCK": ["Kaze", "Darryl", "Cordelius", "Mina", "Melodie"],
            "CLANCY": ["Juju", "Larry & Lawrie", "Bea", "Ziggy", "Ruffs", "Charlie"],
            "COLETTE": ["Belle", "Byron", "Bea", "Crow", "Squeak", "Charlie", "Willow"],
            "COLT": ["Piper", "Belle", "Crow", "Max", "Jae-yong"],
            "CORDELIUS": ["Sandy", "Buster", "Hank", "Ash", "Ruffs", "Tara", "Willow", "Barley"],
            "CROW": ["Gus", "Belle", "Ruffs", "Otis", "Charlie", "Willow", "Juju"],
            "DARRYL": ["Tara", "Charlie", "Cordelius", "Colette", "Otis", "Lou", "Bea", "Shelly"],
            "DOUG": ["Griff", "Willow", "Gene", "Squeak", "Cordelius", "Charlie"],
            "DRACO": ["Lou", "Lumi", "Lola", "Willow", "Otis", "Tara"],
            "DYNAMIKE": ["Mortis", "Kaze", "Brock", "Gray", "Stu", "Sprout"],
            "EDGAR": ["Bull", "Doug", "Cordelius", "Charlie", "Stu", "R-T", "Gale", "Mina"],
            "EL PRIMO": ["Bea", "Griff", "Lou", "Finx", "Dynamike", "Willow"],
            "EMZ": ["Sprout", "Barley", "Crow", "Squeak", "Bea", "Belle", "Kaze", "Mortis", "Lily"],
            "EVE": ["Belle", "Carl", "Alli", "Amber", "Penny", "Brock"],
            "FANG": ["R-T", "Charlie", "Cordelius", "Doug", "Griff"],
            "FINX": ["Crow", "Ruffs", "Otis", "Bo", "Barley", "Belle", "Byron", "Spike"],
            "FRANK": ["Colette", "El Primo", "Bull", "Bea", "Trunk", "Lumi", "Lou", "Maisie", "Ruffs", "Willow", "Dynamike"],
            "GALE": ["Belle", "Bea", "Sprout", "Barley", "Willow", "Crow", "Lola", "Squeak"],
            "GENE": ["Ruffs", "Charlie", "Tick", "Sprout", "Grom", "Penny", "Belle"],
            "GIGI": ["Doug", "Buster", "Gene", "Willow", "Bull"],
            "GRAY": ["Tara", "Charlie", "Gus", "Ruffs", "Eve", "Brock", "Jae-yong", "Max", "Ash", "Ollie"],
            "GRIFF": ["Bea", "Belle", "Crow", "Spike", "Brock", "Janet", "Stu"],
            "GROM": ["Mortis", "Kaze", "Lily", "Tick", "Brock", "Max", "Jae-yong", "Darryl"],
            "GUS": ["Ruffs", "Byron", "Angelo", "Piper", "Sprout", "Tick", "Charlie", "Ash"],
            "HANK": ["Dynamike", "Barley", "Pam", "Otis", "Ruffs", "El Primo", "Frank", "Lou", "Bea", "Lumi", "Griff", "Willow"],
            "JACKY": ["Lumi", "Bea", "Griff", "Lou", "Crow", "Otis", "Barley", "Willow", "Doug", "Frank", "Trunk", "Spike", "Cordelius", "Surge"],
            "JAE-YONG": ["Crow", "Belle", "Bea", "Otis", "Lola", "Kaze", "Lily"],
            "JANET": ["Belle", "Gus", "Crow", "Barley", "Sprout", "Otis", "Squeak"],
            "JESSIE": ["Barley", "Berry", "Belle", "Gus", "Brock", "Kaze"],
            "JUJU": ["Alli", "Larry & Lawrie", "Brock", "Piper", "Carl", "Edgar", "Griff", "Barley"],
            "KAZE": ["Crow", "Gene", "Meeple", "Amber", "Cordelius", "Otis", "Doug", "Buster", "Meg"],
            "KENJI": ["Meg", "Otis", "Frank", "Crow", "Tara", "Jacky", "Trunk", "Bea", "Cordelius", "Bull", "Ash"],
            "KIT": ["Gene", "Amber", "Crow", "Bull", "Jacky"],
            "LARRY & LAWRIE": ["Sprout", "Tick", "Griff", "Brock", "Kaze", "Mortis", "Lily", "Ziggy", "Stu"],
            "LEON": ["Gene", "Meg", "Crow", "Belle", "Stu"],
            "LILY": ["Nita", "Jacky", "Buster", "Bull", "Gene", "Cordelius", "Crow"],
            "LOLA": ["Belle", "Penny", "Squeak", "Byron", "Sprout", "Barley", "Willow"],
            "LOU": ["Bea", "Sprout", "Barley", "Willow", "Belle", "Byron", "Stu", "Ruffs", "Poco"],
            "LUMI": ["Kaze", "Lily", "Byron", "Belle", "Willow", "Sprout", "Barley"],
            "MAISIE": ["Belle", "Gus", "Charlie", "Tara", "Sprout", "Barley", "Willow", "Gene", "Crow", "Ruffs"],
            "MANDY": ["Nani", "Gray", "Angelo", "Piper", "Darryl", "Kaze", "Tick"],
            "MAX": ["Crow", "Lola", "Belle", "Bea", "Otis"],
            "MEEPLE": ["Ruffs", "Lily", "Max", "Charlie", "Brock", "Gray", "Willow", "Sprout", "Janet", "Jessie", "Moe", "Pam"],
            "MEG": ["Crow", "Colette", "Lou", "Amber", "Byron", "Belle", "Finx", "Barley", "Larry & Lawrie", "Dynamike", "Bea"],
            "MELODIE": ["Crow", "Amber", "R-T", "Tara", "Cordelius", "Charlie"],
            "MICO": ["R-T", "Lily", "Meg", "Nani", "Bull", "Cordelius"],
            "MINA": ["Crow", "Otis", "Tara", "Charlie", "Sprout", "Barley", "Lola", "Stu", "Ruffs"],
            "MOE": ["Ruffs", "Otis", "Gus", "Ash", "Crow", "Barley", "Larry & Lawrie"],
            "MORTIS": ["Jacky", "Doug", "Shelly", "Bull", "Cordelius", "Nita", "Stu", "Maisie", "Griff", "Gus"],
            "MR. P": ["Carl", "Ollie", "Mortis", "Byron", "Squeak"],
            "NANI": ["Max", "Gene", "Leon", "Jae-yong", "Tick", "Eve"],
            "NITA": ["Otis", "Griff", "Barley", "Larry & Lawrie", "Dynamike", "Amber", "Lumi"],
            "OLLIE": ["Lumi", "Buster", "Gene", "Poco", "Cordelius"],
            "OTIS": ["Belle", "Gus", "Bea", "Barley", "Willow", "Squeak"],
            "PAM": ["Ruffs", "Barley", "Larry & Lawrie", "Bea", "Belle", "Lola", "Penny", "Squeak", "Colette"],
            "PEARL": ["Brock", "Gene", "Tick", "Barley", "Belle", "Bea", "Gus", "Lola", "Squeak"],
            "PENNY": ["Belle", "Byron", "Nani", "Squeak", "Sprout", "Barley", "Carl", "Berry", "Bo", "Brock"],
            "PIPER": ["Nani", "Max", "Jae-yong", "Kaze", "Tick", "Sprout"],
            "POCO": ["Lola", "Crow", "Belle", "Kaze", "Mortis", "Barley", "Dynamike", "Willow"],
            "RICO": ["Squeak", "Sprout", "Barley", "Carl", "Stu", "Griff", "Brock", "Kaze", "Buzz"],
            "ROSA": ["Frank", "Amber", "Otis", "Lumi", "Lola", "Crow"],
            "R-T": ["Charlie", "Sprout", "Barley", "Willow", "Eve", "Squeak", "Brock", "Ruffs"],
            "RUFFS": ["Squeak", "Barley", "Sprout", "Angelo", "Byron", "Penny", "Janet"],
            "SAM": ["Bea", "Frank", "Trunk", "Bull", "Otis"],
            "SANDY": ["Barley", "Juju", "Larry & Lawrie", "Emz", "Amber", "Crow", "Griff"],
            "SHADE": ["Hank", "Jacky", "Bull", "Trunk", "Cordelius", "Doug", "Meeple", "Frank", "Stu", "Buzz"],
            "SHELLY": ["Bea", "Tara", "Gus", "Ash", "Barley", "Sprout"],
            "SPIKE": ["Belle", "Gus", "Byron", "Sprout", "Barley", "Penny", "Jae-yong", "Carl", "Janet"],
            "SPROUT": ["Tick", "Kaze", "Brock", "Stu", "Lily", "Mortis"],
            "SQUEAK": ["Darryl", "Trunk", "Nani", "Piper", "Brock", "Kaze", "Lily", "Buzz", "Sprout", "Tick"],
            "STU": ["Gus", "Belle", "Lola", "Ruffs", "Crow", "Tara", "Charlie", "Poco", "Bea"],
            "SURGE": ["Ruffs", "Ash", "Gus", "Bea", "Belle", "Barley", "Willow", "Tara", "Spike", "Charlie", "Otis"],
            "TARA": ["Janet", "Sprout", "Barley", "Willow", "Byron", "Carl", "Amber", "Sandy", "Jae-yong", "Buster"],
            "TICK": ["Alli", "Gray", "Piper", "Angelo", "Brock", "Max", "Kaze", "Lily", "Jae-yong"],
            "TRUNK": ["Griff", "Bea", "Lumi", "Frank", "Hank", "Draco"],
            "WILLOW": ["Barley", "Sprout", "Brock", "Lily", "Kaze", "Stu", "Alli"],
            "ZIGGY": ["Mortis", "Lily", "Kaze", "Piper", "Brock", "Darryl", "Trunk", "Max", "Jae-yong"]
        };

        // --- UTILITAIRES ---
        function formatName(name) {
            if(!name) return "";
            name = String(name).trim();
            if (name.toUpperCase() === "8-BIT") return "8-Bit";
            if (name.toUpperCase() === "R-T") return "R-T";
            if (name.toUpperCase() === "MR. P" || name.toUpperCase() === "MR.P") return "Mr. P";
            return name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
        }

        function getFileName(name) {
            return name.toLowerCase().replace(/&/g, '').replace(/\./g, '').replace(/[\s-]+/g, '_') + '_portrait.png';
        }

        // --- INIT DATA ---
        const counterData = {};
        const allBrawlersSet = new Set();
        Object.keys(rawData).forEach(key => {
            const cleanKey = formatName(key);
            allBrawlersSet.add(cleanKey);
            const counters = rawData[key].map(val => {
                const cleanVal = formatName(val);
                allBrawlersSet.add(cleanVal);
                return cleanVal;
            });
            if(counterData[cleanKey]) counterData[cleanKey] = [...new Set([...(counterData[cleanKey]||[]), ...counters])];
            else counterData[cleanKey] = counters;
        });
        const allBrawlers = Array.from(allBrawlersSet).sort();
        
        // --- STATE ---
        let state = { 
            ban: [null,null,null,null,null,null], 
            enemy: [null,null,null], 
            ally: [null,null,null], 
            activeSlot: {type:null,index:null},
            firstPick: 'ally'
        };

        // --- LOGIQUE METIER ---
        function getWeaknessesOf(brawlerName) {
            return counterData[brawlerName] || [];
        }

        // --- INIT GRILLE ---
        const gridElement = document.getElementById('grid');
        function initGrid() {
            gridElement.innerHTML = '';
            allBrawlers.forEach(brawler => {
                const div = document.createElement('div');
                div.className = 'brawler-card';
                div.id = `card-${brawler.replace(/[\s.]/g, '-')}`; 
                div.onclick = () => handleBrawlerClick(brawler);
                
                const fileName = getFileName(brawler);
                div.innerHTML = `
                    <img src="icons/${fileName}" onerror="this.onerror=null; this.src='https://via.placeholder.com/60?text=?'; this.parentElement.querySelector('.img-error-text').innerText = 'Manque: ${fileName}';">
                    <div class="name">${brawler}</div>
                    <div class="interactions-container">
                        <div class="mini-icon-group group-victims"></div>
                        <div class="mini-icon-group group-killers"></div>
                    </div>
                    <div class="img-error-text"></div>
                `;
                gridElement.appendChild(div);
            });
        }

        function selectSlot(element, type, index) {
            document.querySelectorAll('.ban-slot, .pick-slot').forEach(el => el.classList.remove('active'));
            state.activeSlot = { type, index };
            if(element) element.classList.add('active');
        }

        function toggleFirstPick() {
            const btn = document.getElementById('btn-fp');
            if (state.firstPick === 'ally') {
                state.firstPick = 'enemy';
                btn.className = 'fp-enemy';
                btn.innerText = '1st PICK: ADV';
            } else {
                state.firstPick = 'ally';
                btn.className = 'fp-ally';
                btn.innerText = '1st PICK: MOI';
            }
        }

        function handleBrawlerClick(brawlerName) {
            if (!state.activeSlot.type) { alert("Sélectionnez d'abord un emplacement !"); return; }
            const { type, index } = state.activeSlot;
            
            if (type !== 'ban' && isPickedOrBanned(brawlerName)) {
                if (state[type][index] !== brawlerName) return; 
            }
            
            state[type][index] = brawlerName;
            updateSlotUI(type, index, brawlerName);
            updateGridState();
            advanceToNextSlot(type, index);
        }

        function advanceToNextSlot(currentType, currentIndex) {
            if (currentType === 'ban') {
                if (currentIndex < 5) {
                    selectSlot(document.querySelectorAll('.ban-slot')[currentIndex + 1], 'ban', currentIndex + 1);
                } else {
                    const fpTeam = state.firstPick;
                    const panelIndex = (fpTeam === 'enemy') ? 0 : 1;
                    selectSlot(document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[0], fpTeam, 0);
                }
                return;
            }
            const A = state.firstPick;
            const B = (A === 'ally') ? 'enemy' : 'ally';
            const sequence = [
                { type: A, index: 0 }, { type: B, index: 0 }, { type: B, index: 1 }, 
                { type: A, index: 1 }, { type: A, index: 2 }, { type: B, index: 2 }
            ];
            let currentStepIndex = -1;
            for (let i = 0; i < sequence.length; i++) {
                if (sequence[i].type === currentType && sequence[i].index === currentIndex) {
                    currentStepIndex = i;
                    break;
                }
            }
            if (currentStepIndex !== -1 && currentStepIndex < sequence.length - 1) {
                const nextStep = sequence[currentStepIndex + 1];
                const panelIndex = (nextStep.type === 'enemy') ? 0 : 1;
                selectSlot(document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[nextStep.index], nextStep.type, nextStep.index);
            }
        }

        function isPickedOrBanned(name) {
            if (state.ban.includes(name)) return true;
            if (state.enemy.includes(name)) return true;
            if (state.ally.includes(name)) return true;
            return false;
        }

        function updateSlotUI(type, index, name) {
            const fileName = getFileName(name);
            let element;
            if (type === 'ban') {
                element = document.querySelectorAll('.ban-slot')[index];
                element.innerHTML = `<img src="icons/${fileName}" onerror="this.src='https://via.placeholder.com/60?text=${name.charAt(0)}'"><div class="ban-icon-overlay">X</div>`;
                element.classList.add('banned');
            } else {
                const panelIndex = type === 'enemy' ? 0 : 1;
                element = document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[index];
                element.innerHTML = `<img src="icons/${fileName}" onerror="this.src='https://via.placeholder.com/100?text=?'"><span>${name}</span>`;
            }
        }

        function updateGridState() {
            const activeEnemies = state.enemy.filter(e => e);
            const activeAllies = state.ally.filter(a => a);

            allBrawlers.forEach(brawler => {
                const safeId = brawler.replace(/[\s.]/g, '-');
                const card = document.getElementById(`card-${safeId}`);
                if (!card) return;
                
                // Reset complet
                card.className = 'brawler-card';
                const victimsContainer = card.querySelector('.group-victims');
                const killersContainer = card.querySelector('.group-killers');
                victimsContainer.innerHTML = '';
                killersContainer.innerHTML = '';

                // 1. Disable
                if (state.ban.includes(brawler)) {
                    card.classList.add('disabled', 'banned');
                    return;
                } else if (activeEnemies.includes(brawler) || activeAllies.includes(brawler)) {
                    card.classList.add('disabled');
                    return;
                }

                // 2. ANALYSE INTERACTIONS
                let victims = []; // Ennemis que je tue
                let killers = []; // Ennemis qui me tuent

                activeEnemies.forEach(enemy => {
                    // Est-ce que 'enemy' est une victime de 'brawler' ?
                    if (getWeaknessesOf(enemy).includes(brawler)) {
                        victims.push(enemy);
                    }
                    // Est-ce que 'enemy' est un tueur de 'brawler' ?
                    if (getWeaknessesOf(brawler).includes(enemy)) {
                        killers.push(enemy);
                    }
                });

                // 3. GENERATION MINI ICONES
                victims.forEach(vName => {
                    const img = document.createElement('img');
                    img.src = "icons/" + getFileName(vName);
                    img.className = "mini-icon victim";
                    victimsContainer.appendChild(img);
                });
                killers.forEach(kName => {
                    const img = document.createElement('img');
                    img.src = "icons/" + getFileName(kName);
                    img.className = "mini-icon killer";
                    killersContainer.appendChild(img);
                });

                // 4. SCORE NET et CLASSIFICATION
                const scoreNet = victims.length - killers.length;
                const threats = killers.length;
                
                // Si aucune menace, logique classique Or/Vert
                if (threats === 0) {
                    if (scoreNet >= 2) {
                        card.classList.add('status-ideal'); // Or
                    } else if (scoreNet > 0) {
                        card.classList.add('status-good');  // Vert Sûr
                    }
                }
                // Si menaces, logique de risque
                else {
                    if (scoreNet > 0) {
                        // Positif mais risqué (ex: tue 2, meurt par 1) -> Vert Risqué
                        card.classList.add('status-good-risky');
                    }
                    else if (scoreNet === 0) {
                        card.classList.add('status-mixed'); // Bleu
                    }
                    else if (scoreNet === -1) {
                        card.classList.add('status-bad');   // Rouge
                    }
                    else {
                        card.classList.add('status-fatal'); // Violet
                    }
                }
            });
        }

        function filterGrid() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.brawler-card');
            cards.forEach(card => {
                const name = card.querySelector('.name').innerText.toLowerCase();
                card.style.display = name.includes(term) ? 'flex' : 'none';
            });
        }

        function clearCurrentSlot() {
            const { type, index } = state.activeSlot;
            if (!type) return;
            state[type][index] = null;
            clearSlot(type, index);
            updateGridState();
        }

        function clearSlot(type, index) {
             if (type === 'ban') {
                const el = document.querySelectorAll('.ban-slot')[index];
                el.innerHTML = ''; el.classList.remove('banned');
            } else {
                const panelIndex = type === 'enemy' ? 0 : 1;
                const el = document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[index];
                el.innerHTML = `<span>Pick ${index+1}</span>`;
            }
        }

        function resetDraft() {
            if(!confirm("Tout réinitialiser ?")) return;
            state.ban = [null,null,null,null,null,null];
            state.enemy = [null,null,null];
            state.ally = [null,null,null];
            document.querySelectorAll('.ban-slot').forEach(el => { el.innerHTML = ''; el.classList.remove('banned'); });
            document.querySelectorAll('.pick-slot').forEach((el, i) => {
                const idx = Array.from(el.parentNode.children).indexOf(el) - 1; 
                el.innerHTML = `<span>Pick ${idx + 1}</span>`;
            });
            state.firstPick = 'ally';
            const btn = document.getElementById('btn-fp');
            btn.className = 'fp-ally';
            btn.innerText = '1st PICK: MOI';
            updateGridState();
            setTimeout(() => { selectSlot(document.querySelectorAll('.ban-slot')[0], 'ban', 0); }, 50);
        }

        // --- LANCEMENT ---
        initGrid();
        selectSlot(document.querySelectorAll('.ban-slot')[0], 'ban', 0);

    </script>
</body>
</html>
