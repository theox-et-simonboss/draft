<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Board</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* PALETTE PRO & CLEAN */
            --bg-gradient: linear-gradient(135deg, #111827 0%, #030712 100%);
            --panel-bg: rgba(31, 41, 55, 0.7);
            --card-bg: #1f2937;
            --border-color: rgba(75, 85, 99, 0.4);
            
            --text-main: #f3f4f6;
            --text-muted: #9ca3af;
            
            --pick-enemy: #fb923c;
            --pick-ally: #38bdf8;
            
            /* LOGICAL STATES */
            --col-perfect: #22d3ee;
            --col-ideal: #facc15;
            --col-good: #4ade80;
            --col-mixed: #94a3b8;
            --col-bad: #f87171;
            --col-fatal: #c084fc;
            --col-worst: #374151;
            --col-ban: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            margin: 0;
            padding: 24px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
        }

        /* --- TOP BAR (Modified Layout) --- */
        .top-bar { 
            display: grid; /* Changed to Grid for perfect centering */
            grid-template-columns: 1fr auto 1fr; /* Left (1fr) Center (auto) Right (1fr) */
            align-items: center; 
            margin-bottom: 20px;
            padding: 16px 24px;
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Align grid items */
        .roster-controls { justify-self: start; }
        .bans-container-wrapper { justify-self: center; } /* Wrapper to center the bans */
        .controls { justify-self: end; display: flex; gap: 10px; }

        button { 
            padding: 8px 16px; border: 1px solid transparent; border-radius: 8px; 
            cursor: pointer; font-weight: 600; font-size: 13px; font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
        }
        
        .btn-reset { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.2); color: var(--col-ban); }
        .btn-reset:hover { background: rgba(239, 68, 68, 0.2); }

        .btn-undo { background: rgba(255, 255, 255, 0.05); border-color: var(--border-color); color: var(--text-main); }
        .btn-undo:hover { background: rgba(255, 255, 255, 0.1); }
        
        #btn-fp { width: 140px; }
        .fp-ally { background: var(--pick-ally); color: #0f172a; border-color: var(--pick-ally); }
        .fp-enemy { background: var(--pick-enemy); color: #0f172a; border-color: var(--pick-enemy); }

        .bans-container { 
            display: flex; gap: 10px; background: rgba(0, 0, 0, 0.2); padding: 6px 12px;
            border-radius: 12px; border: 1px solid var(--border-color);
        }
        .ban-slot {
            width: 40px; height: 40px; background: rgba(255, 255, 255, 0.03); 
            border: 1px solid var(--border-color); border-radius: 8px;
            display: flex; justify-content: center; align-items: center; 
            cursor: pointer; overflow: hidden; position: relative; transition: border-color 0.2s;
        }
        .ban-slot:hover, .ban-slot.active { border-color: var(--col-ban); }
        .ban-slot img { width: 100%; height: 100%; object-fit: cover; opacity: 0.5; filter: grayscale(100%); }
        .ban-slot.banned { border-color: var(--col-ban); background: rgba(220, 38, 38, 0.1); }
        .ban-icon-overlay { position: absolute; font-size: 18px; color: var(--col-ban); font-weight: bold; pointer-events: none; }

        /* --- ROSTER MODAL & TOGGLE STYLES --- */
        .roster-item {
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid transparent;
            opacity: 0.3;
            filter: grayscale(100%);
            transition: all 0.1s;
            position: relative;
            background: #000;
        }
        .roster-item.owned {
            opacity: 1;
            filter: grayscale(0%);
            border-color: var(--col-good);
        }
        .roster-item:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        .roster-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        /* Style for active toggle */
        .toggle-active #roster-toggle-btn { background: var(--pick-ally) !important; }
        .toggle-active #roster-toggle-circle { transform: translateX(16px) !important; }

        /* --- DRAFT AREA --- */
        .draft-area { display: flex; flex: 1; gap: 24px; overflow: hidden; }
        
        .team-panel { width: 150px; display: flex; flex-direction: column; gap: 12px; flex-shrink: 0; }
        .team-title {
            text-align: left; font-size: 12px; font-weight: 700; 
            letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 4px; 
            display: flex; align-items: center; gap: 8px;
        }
        .team-title::before { content: ''; width: 8px; height: 8px; border-radius: 50%; display: block; }
        
        .pick-slot {
            height: 100px; background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 12px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: visible; transition: all 0.2s ease; 
        }
        .pick-slot > img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
        .pick-slot span { 
            position: absolute; bottom: 6px; font-size: 11px; font-weight: 500;
            color: var(--text-muted); pointer-events: none; 
            background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 12px; backdrop-filter: blur(4px);
            z-index: 2;
        }
        .pick-slot:hover { border-color: var(--text-muted); }
        .pick-slot.enemy.active { border-color: var(--pick-enemy); box-shadow: 0 0 0 1px var(--pick-enemy); z-index: 5; }
        .pick-slot.ally.active { border-color: var(--pick-ally); box-shadow: 0 0 0 1px var(--pick-ally); z-index: 5; }

        /* --- INTEGRATION OEIL DE FOCUS --- */
        .isolation-eye {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 36px; height: 36px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; /* Hidden by default */
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            z-index: 20;
            color: white;
            pointer-events: auto;
        }
        
        /* Appear on hover */
        .pick-slot:hover .isolation-eye { 
            opacity: 1; 
            transform: translate(-50%, -50%) scale(1);
        }
        
        /* Active state (clicked) */
        .isolation-eye.active-eye {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1);
            background: var(--col-perfect); /* Cyan */
            color: #000;
            border-color: transparent;
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.6);
        }
        
        .isolation-eye svg { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }


        /* --- MINI ICONS --- */
        .slot-interactions {
            position: absolute;
            top: 4px; left: 4px; right: 4px;
            display: flex; justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }
        .slot-victims { display: flex; flex-direction: column; gap: 2px; align-items: flex-start; }
        .slot-killers { display: flex; flex-direction: column; gap: 2px; align-items: flex-end; }

        .slot-mini-icon {
            width: 27px; height: 27px; border-radius: 75%; border: 2px solid white; background: #000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.8); object-fit: cover;
        }
        .slot-mini-icon.victim { border-color: var(--col-good); }
        .slot-mini-icon.killer { border-color: var(--col-bad); } 


        /* --- GRID CONTAINER --- */
        .grid-container {
            flex: 1; background: var(--panel-bg); border-radius: 16px; padding: 20px;
            display: flex; flex-direction: column; overflow: hidden; position: relative;
            border: 1px solid var(--border-color); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .search-wrapper { position: relative; width: 100%; max-width: 90%; margin: 0 auto 16px auto; flex-shrink: 0; }
        
        .search-bar {
            width: 100%; padding: 12px 40px 12px 16px; 
            background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color); color: var(--text-main);
            border-radius: 10px; font-size: 14px; font-family: 'Inter', sans-serif;
            outline: none; transition: 0.2s; box-sizing: border-box;
        }
        .search-bar:focus { border-color: var(--pick-ally); background: rgba(0, 0, 0, 0.3); }
        .search-bar::placeholder { color: #6b7280; }

        .search-clear-btn {
            position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
            cursor: pointer; color: var(--text-muted); font-size: 14px; font-weight: bold;
            display: none; padding: 4px;
        }
        .search-clear-btn:hover { color: var(--text-main); }

        .scroll-area {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
            padding-bottom: 20px;
        }

        .grid-separator {
            width: 100%;
            border-bottom: 1px dashed var(--border-color);
            margin: 15px 0;
            text-align: center;
            font-size: 10px;
            color: var(--text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
            display: none;
        }

        .grid-break { grid-column: 1 / -1; height: 24px; width: 100%; }

        .brawlers-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            gap: 10px;
            align-items: start;
        }

        /* --- BRAWLER CARD --- */
        .brawler-card {
            background: var(--card-bg); border-radius: 10px; cursor: pointer;
            border: 1px solid var(--border-color);
            position: relative; 
            height: 100px; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center;
            padding: 6px;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .brawler-card.expanded {
            height: 110px; 
            justify-content: flex-start;
            background: #252e3d;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .brawler-card:hover { transform: translateY(-2px); background: #374151; z-index: 5; }
        
        .brawler-card > img { 
            width: 100%; height: auto; max-height: 60px; object-fit: contain; 
            margin-top: 0; transition: max-height 0.2s;
        }
        .brawler-card.expanded > img { max-height: 60px; margin-top: 2px; }
        
        .brawler-card .name { 
            font-size: 11px; font-weight: 600; text-align: center; 
            width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
            margin-top: 6px; color: var(--text-main); flex-shrink: 0; 
        }

        .img-error-text { font-size: 7px; color: var(--col-ban); margin-top: 2px; text-align: center; line-height: 1; }

        /* STATUS STYLES */
        .brawler-card.status-perfect { border: 2px solid var(--col-perfect); background: rgba(34, 211, 238, 0.15); }
        .brawler-card.status-ideal { border: 2px solid var(--col-ideal); background: rgba(250, 204, 21, 0.1); }
        .brawler-card.status-good { border: 2px solid var(--col-good); background: rgba(74, 222, 128, 0.08); }
        .brawler-card.status-good-risky { border: 2px dashed var(--col-good); background: rgba(74, 222, 128, 0.08); }
        .brawler-card.status-mixed { border: 2px solid var(--col-mixed); opacity: 1; }
        .brawler-card.status-bad { border: 2px solid var(--col-bad); opacity: 0.8; }
        .brawler-card.status-fatal { border: 2px solid var(--col-fatal); opacity: 0.7; }
        .brawler-card.status-worst { border: 2px solid var(--col-worst); background: #111; opacity: 0.5; filter: grayscale(100%); }
        
        .brawler-card.disabled { opacity: 0.1; filter: grayscale(100%); pointer-events: none; border-color: transparent; }
        .brawler-card.banned { opacity: 0.5; pointer-events: none; border-color: var(--col-ban); filter: grayscale(100%); }
        .brawler-card.banned::after { content: '‚úï'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 32px; color: var(--col-ban); font-weight: bold; }

        .interactions-container { 
            width: 100%; 
            display: none; 
            flex-direction: row; 
            justify-content: space-between; 
            align-items: flex-end; 
            margin-top: auto; 
            padding: 0 4px; 
            padding-bottom: 2px; 
            pointer-events: none; 
            flex-shrink: 0;
            box-sizing: border-box;
        }
        .brawler-card.expanded .interactions-container { display: flex; }

        .mini-icon-group { display: flex; gap: 2px; height: 24px; }
        .group-victims { justify-content: flex-start; }
        .group-killers { justify-content: flex-end; }

        .mini-icon { 
            width: 24px; height: 24px; object-fit: cover; border-radius: 50%; 
            border: 1px solid var(--card-bg); background: #000; 
        }
        .mini-icon.victim { border-color: var(--col-good); box-shadow: 0 0 3px var(--col-good); }
        .mini-icon.killer { border-color: var(--col-bad); box-shadow: 0 0 3px var(--col-bad); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        #mobile-warning { display: none; }
        @media screen and (max-width: 1024px) {
            .top-bar, .draft-area { display: none !important; }
            body { padding: 0; margin: 0; justify-content: center; align-items: center; background: #0f0f0f; }
            #mobile-warning { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; width: 100%; height: 100%; padding: 20px; }
            .warning-content { background: var(--panel-bg); padding: 30px; border-radius: 12px; border: 1px solid var(--border-color); }
            .warning-title { font-size: 18px; font-weight: 600; color: var(--text-main); margin-bottom: 12px; }
            .warning-text { color: var(--text-muted); font-size: 14px; }
        }
    </style>
</head>
<body>

    <div id="mobile-warning">
        <div class="warning-content">
            <div class="warning-icon" style="font-size: 32px; margin-bottom: 16px;">üíª</div>
            <div class="warning-title">Draft Board Desktop</div>
            <div class="warning-text">Please use a computer to access the draft assistant.</div>
        </div>
    </div>

    <div class="top-bar">
        <div class="roster-controls" style="display: flex; gap: 10px; align-items: center;">
            <button class="btn-undo" onclick="openRosterModal()">‚öôÔ∏è My Roster</button>
            <div class="toggle-container" onclick="toggleOwnedFilter()" style="cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-muted);">
                <div id="roster-toggle-btn" style="width: 36px; height: 20px; background: #374151; border-radius: 20px; position: relative; transition: 0.2s;">
                    <div id="roster-toggle-circle" style="width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.2s;"></div>
                </div>
                <span>Filter: Owned</span>
            </div>
        </div>
        
        <div class="bans-container-wrapper">
            <div class="bans-container">
                <div class="ban-slot" onclick="selectSlot(this, 'ban', 0)"></div>
                <div class="ban-slot" onclick="selectSlot(this, 'ban', 1)"></div>
                <div class="ban-slot" onclick="selectSlot(this, 'ban', 2)"></div>
                <div class="ban-slot" onclick="selectSlot(this, 'ban', 3)"></div>
                <div class="ban-slot" onclick="selectSlot(this, 'ban', 4)"></div>
                <div class="ban-slot" onclick="selectSlot(this, 'ban', 5)"></div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-undo" onclick="clearCurrentSlot()">CLEAR</button>
            <button class="btn-reset" onclick="resetDraft()">RESET</button>
            <button id="btn-fp" class="fp-ally" onclick="toggleFirstPick()">1À¢·µó pick : Me</button>
        </div>
    </div>

    <div class="draft-area">
        <div class="team-panel">
            <div class="team-title" style="color: var(--pick-enemy);">
                <style>.team-title:first-child::before { background: var(--pick-enemy); }</style>
                Opponents
            </div>
            <div class="pick-slot enemy" onclick="selectSlot(this, 'enemy', 0)"><span>Pick 1</span></div>
            <div class="pick-slot enemy" onclick="selectSlot(this, 'enemy', 1)"><span>Pick 2</span></div>
            <div class="pick-slot enemy" onclick="selectSlot(this, 'enemy', 2)"><span>Pick 3</span></div>
        </div>

        <div class="grid-container">
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-bar" placeholder="Search for a brawler..." onkeyup="filterGrid()" autofocus>
                <div id="searchClear" class="search-clear-btn" onclick="clearSearch()">‚úï</div>
            </div>
            
            <div class="scroll-area">
                <div id="active-grid" class="brawlers-grid"></div>
                
                <div id="grid-separator" class="grid-separator">Other Choices</div>
                
                <div id="neutral-grid" class="brawlers-grid"></div>
            </div>
        </div>

        <div class="team-panel">
            <div class="team-title" style="color: var(--pick-ally);">
                 <style>.team-panel:last-child .team-title::before { background: var(--pick-ally); }</style>
                My Team
            </div>
            <div class="pick-slot ally" onclick="selectSlot(this, 'ally', 0)"><span>Pick 1</span></div>
            <div class="pick-slot ally" onclick="selectSlot(this, 'ally', 1)"><span>Pick 2</span></div>
            <div class="pick-slot ally" onclick="selectSlot(this, 'ally', 2)"><span>Pick 3</span></div>
        </div>
    </div>

    <div id="roster-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; backdrop-filter: blur(5px); background: rgba(0,0,0,0.7); justify-content: center; align-items: center;">
        <div style="background: var(--card-bg); width: 80%; max-width: 800px; max-height: 80vh; border-radius: 16px; border: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 24px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; font-size: 20px;">Manage My Brawlers</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-undo" onclick="selectAllRoster(true)">Select All</button>
                    <button class="btn-undo" onclick="selectAllRoster(false)">Deselect All</button>
                    <button class="fp-ally" onclick="closeRosterModal()" style="margin-left: 10px;">Save & Close</button>
                </div>
            </div>
            <div style="margin-bottom: 10px; color: var(--text-muted); font-size: 13px;">Click on the brawlers you own (grayed out ones will be hidden if the filter is active).</div>
            <div id="roster-grid" style="flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 8px; padding-right: 8px;">
                </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const rawData = {
            "8-BIT": ["Belle", "Squeak", "Penny", "Barley", "Sprout", "Bo", "Mina"],
            "ALLI": ["Doug", "Trunk", "Bull", "R-T", "Jacky"],
            "AMBER": ["Crow", "Belle", "Lily", "Byron", "Sprout"],
            "ANGELO": ["Gray", "Max", "Nani", "Eve", "Darryl"],
            "ASH": ["Frank", "Trunk", "Otis", "Mina", "Carl", "Emz"],
            "BARLEY": ["Sprout", "Tick", "Griff", "Kaze", "Lily", "Carl", "Stu", "Brock"],
            "BEA": ["Brock", "Belle", "Sprout", "Bo", "Gus"],
            "BELLE": ["Piper", "Byron", "Nani", "Sprout", "Mandy"],
            "BERRY": ["Barley", "Frank", "Griff", "Kaze", "Dynamike"],
            "BIBI": ["Bea", "Lumi", "Ash", "Bull", "Griff"],
            "BO": ["Kaze", "Lily", "Stu", "Piper", "Kenji"],
            "BONNIE": ["Nani", "Piper", "Brock", "Charlie", "Angelo", "Tick"],
            "BROCK": ["Piper", "Angelo", "Nani", "Mandy", "Jae-yong", "Max", "Darryl", "Kaze", "Ollie"],
            "BULL": ["Tara", "Cordelius", "Charlie", "Willow", "Griff"],
            "BUSTER": ["Ash", "Brock", "Squeak", "Trunk", "Willow", "Barley"],
            "BUZZ": ["Bull", "Doug", "Gene", "Finx", "Stu", "Meeple", "Cordelius"],
            "BYRON": ["Piper", "Nani", "Sprout", "Tick", "Poco", "Kaze", "Lily"],
            "CARL": ["Stu", "Darryl", "Buster", "Colette", "Crow", "Gus", "Buzz"],
            "CHARLIE": ["Squeak", "Byron", "Brock", "Angelo", "Amber", "Sprout", "Tick", "Willow", "Penny", "Jae-yong"],
            "CHESTER": ["Squeak", "Carl", "Crow", "Byron", "Belle", "Sprout", "Barley", "Willow"],
            "CHUCK": ["Kaze", "Darryl", "Cordelius", "Mina", "Melodie"],
            "CLANCY": ["Juju", "Larry & Lawrie", "Bea", "Ziggy", "Ruffs", "Charlie"],
            "COLETTE": ["Belle", "Byron", "Bea", "Crow", "Squeak", "Charlie", "Willow"],
            "COLT": ["Piper", "Belle", "Crow", "Max", "Jae-yong"],
            "CORDELIUS": ["Sandy", "Buster", "Hank", "Ash", "Ruffs", "Tara", "Willow", "Barley"],
            "CROW": ["Gus", "Belle", "Ruffs", "Otis", "Charlie", "Willow", "Juju"],
            "DARRYL": ["Tara", "Charlie", "Cordelius", "Colette", "Otis", "Lou", "Bea", "Shelly"],
            "DOUG": ["Griff", "Willow", "Gene", "Squeak", "Cordelius", "Charlie"],
            "DRACO": ["Lou", "Lumi", "Lola", "Willow", "Otis", "Tara"],
            "DYNAMIKE": ["Mortis", "Kaze", "Brock", "Gray", "Stu", "Sprout"],
            "EDGAR": ["Bull", "Doug", "Cordelius", "Charlie", "Stu", "R-T", "Gale", "Mina"],
            "EL PRIMO": ["Bea", "Griff", "Lou", "Finx", "Dynamike", "Willow"],
            "EMZ": ["Sprout", "Barley", "Crow", "Squeak", "Bea", "Belle", "Kaze", "Mortis", "Lily"],
            "EVE": ["Belle", "Carl", "Alli", "Amber", "Penny", "Brock"],
            "FANG": ["R-T", "Charlie", "Cordelius", "Doug", "Griff"],
            "FINX": ["Crow", "Ruffs", "Otis", "Bo", "Barley", "Belle", "Byron", "Spike"],
            "FRANK": ["Colette", "El Primo", "Bull", "Bea", "Trunk", "Lumi", "Lou", "Maisie", "Ruffs", "Willow", "Dynamike"],
            "GALE": ["Belle", "Bea", "Sprout", "Barley", "Willow", "Crow", "Lola", "Squeak"],
            "GENE": ["Ruffs", "Charlie", "Tick", "Sprout", "Grom", "Penny", "Belle"],
            "GIGI": ["Doug", "Buster", "Gene", "Willow", "Bull"],
            "GRAY": ["Tara", "Charlie", "Gus", "Ruffs", "Eve", "Brock", "Jae-yong", "Max", "Ash", "Ollie"],
            "GRIFF": ["Bea", "Belle", "Crow", "Spike", "Brock", "Janet", "Stu"],
            "GROM": ["Mortis", "Kaze", "Lily", "Tick", "Brock", "Max", "Jae-yong", "Darryl"],
            "GUS": ["Ruffs", "Byron", "Angelo", "Piper", "Sprout", "Tick", "Charlie", "Ash"],
            "HANK": ["Dynamike", "Barley", "Pam", "Otis", "Ruffs", "El Primo", "Frank", "Lou", "Bea", "Lumi", "Griff", "Willow"],
            "JACKY": ["Lumi", "Bea", "Griff", "Lou", "Crow", "Otis", "Barley", "Willow", "Doug", "Frank", "Trunk", "Spike", "Cordelius", "Surge"],
            "JAE-YONG": ["Crow", "Belle", "Bea", "Otis", "Lola", "Kaze", "Lily"],
            "JANET": ["Belle", "Gus", "Crow", "Barley", "Sprout", "Otis", "Squeak"],
            "JESSIE": ["Barley", "Berry", "Belle", "Gus", "Brock", "Kaze"],
            "JUJU": ["Alli", "Larry & Lawrie", "Brock", "Piper", "Carl", "Edgar", "Griff", "Barley"],
            "KAZE": ["Crow", "Gene", "Meeple", "Amber", "Cordelius", "Otis", "Doug", "Buster", "Meg"],
            "KENJI": ["Meg", "Otis", "Frank", "Crow", "Tara", "Jacky", "Trunk", "Bea", "Cordelius", "Bull", "Ash"],
            "KIT": ["Gene", "Amber", "Crow", "Bull", "Jacky"],
            "LARRY & LAWRIE": ["Sprout", "Tick", "Griff", "Brock", "Kaze", "Mortis", "Lily", "Ziggy", "Stu"],
            "LEON": ["Gene", "Meg", "Crow", "Belle", "Stu"],
            "LILY": ["Nita", "Jacky", "Buster", "Bull", "Gene", "Cordelius", "Crow"],
            "LOLA": ["Belle", "Penny", "Squeak", "Byron", "Sprout", "Barley", "Willow"],
            "LOU": ["Bea", "Sprout", "Barley", "Willow", "Belle", "Byron", "Stu", "Ruffs", "Poco"],
            "LUMI": ["Kaze", "Lily", "Byron", "Belle", "Willow", "Sprout", "Barley"],
            "MAISIE": ["Belle", "Gus", "Charlie", "Tara", "Sprout", "Barley", "Willow", "Gene", "Crow", "Ruffs"],
            "MANDY": ["Nani", "Gray", "Angelo", "Piper", "Darryl", "Kaze", "Tick"],
            "MAX": ["Crow", "Lola", "Belle", "Bea", "Otis"],
            "MEEPLE": ["Ruffs", "Lily", "Max", "Charlie", "Brock", "Gray", "Willow", "Sprout", "Janet", "Jessie", "Moe", "Pam"],
            "MEG": ["Crow", "Colette", "Lou", "Amber", "Byron", "Belle", "Finx", "Barley", "Larry & Lawrie", "Dynamike", "Bea"],
            "MELODIE": ["Crow", "Amber", "R-T", "Tara", "Cordelius", "Charlie"],
            "MICO": ["R-T", "Lily", "Meg", "Nani", "Bull", "Cordelius"],
            "MINA": ["Crow", "Otis", "Tara", "Charlie", "Sprout", "Barley", "Lola", "Stu", "Ruffs"],
            "MOE": ["Ruffs", "Otis", "Gus", "Ash", "Crow", "Barley", "Larry & Lawrie"],
            "MORTIS": ["Jacky", "Doug", "Shelly", "Bull", "Cordelius", "Nita", "Stu", "Maisie", "Griff", "Gus"],
            "MR. P": ["Carl", "Ollie", "Mortis", "Byron", "Squeak"],
            "NANI": ["Max", "Gene", "Leon", "Jae-yong", "Tick", "Eve"],
            "NITA": ["Otis", "Griff", "Barley", "Larry & Lawrie", "Dynamike", "Amber", "Lumi"],
            "OLLIE": ["Lumi", "Buster", "Gene", "Poco", "Cordelius"],
            "OTIS": ["Belle", "Gus", "Bea", "Barley", "Willow", "Squeak"],
            "PAM": ["Ruffs", "Barley", "Larry & Lawrie", "Bea", "Belle", "Lola", "Penny", "Squeak", "Colette"],
            "PEARL": ["Brock", "Gene", "Tick", "Barley", "Belle", "Bea", "Gus", "Lola", "Squeak"],
            "PENNY": ["Belle", "Byron", "Nani", "Squeak", "Sprout", "Barley", "Carl", "Berry", "Bo", "Brock"],
            "PIPER": ["Nani", "Max", "Jae-yong", "Kaze", "Tick", "Sprout"],
            "POCO": ["Lola", "Crow", "Belle", "Kaze", "Mortis", "Barley", "Dynamike", "Willow"],
            "RICO": ["Squeak", "Sprout", "Barley", "Carl", "Stu", "Griff", "Brock", "Kaze", "Buzz"],
            "ROSA": ["Frank", "Amber", "Otis", "Lumi", "Lola", "Crow"],
            "R-T": ["Charlie", "Sprout", "Barley", "Willow", "Eve", "Squeak", "Brock", "Ruffs"],
            "RUFFS": ["Squeak", "Barley", "Sprout", "Angelo", "Byron", "Penny", "Janet"],
            "SAM": ["Bea", "Frank", "Trunk", "Bull", "Otis"],
            "SANDY": ["Barley", "Juju", "Larry & Lawrie", "Emz", "Amber", "Crow", "Griff"],
            "SHADE": ["Hank", "Jacky", "Bull", "Trunk", "Cordelius", "Doug", "Meeple", "Frank", "Stu", "Buzz"],
            "SHELLY": ["Bea", "Tara", "Gus", "Ash", "Barley", "Sprout"],
            "SPIKE": ["Belle", "Gus", "Byron", "Sprout", "Barley", "Penny", "Jae-yong", "Carl", "Janet"],
            "SPROUT": ["Tick", "Kaze", "Brock", "Stu", "Lily", "Mortis"],
            "SQUEAK": ["Darryl", "Trunk", "Nani", "Piper", "Brock", "Kaze", "Lily", "Buzz", "Sprout", "Tick"],
            "STU": ["Gus", "Belle", "Lola", "Ruffs", "Crow", "Tara", "Charlie", "Poco", "Bea"],
            "SURGE": ["Ruffs", "Ash", "Gus", "Bea", "Belle", "Barley", "Willow", "Tara", "Spike", "Charlie", "Otis"],
            "TARA": ["Janet", "Sprout", "Barley", "Willow", "Byron", "Carl", "Amber", "Sandy", "Jae-yong", "Buster"],
            "TICK": ["Alli", "Gray", "Piper", "Angelo", "Brock", "Max", "Kaze", "Lily", "Jae-yong"],
            "TRUNK": ["Griff", "Bea", "Lumi", "Frank", "Hank", "Draco"],
            "WILLOW": ["Barley", "Sprout", "Brock", "Lily", "Kaze", "Stu", "Alli"],
            "ZIGGY": ["Mortis", "Lily", "Kaze", "Piper", "Brock", "Darryl", "Trunk", "Max", "Jae-yong"]
        };

        // --- UTILS ---
        function formatName(name) {
            if(!name) return "";
            name = String(name).trim();
            if (name.toUpperCase() === "8-BIT") return "8-Bit";
            if (name.toUpperCase() === "R-T") return "R-T";
            if (name.toUpperCase() === "MR. P" || name.toUpperCase() === "MR.P") return "Mr. P";
            return name.toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
        }

        function getFileName(name) {
            return name.toLowerCase().replace(/&/g, '').replace(/\./g, '').replace(/[\s-]+/g, '_') + '_portrait.png';
        }

        // --- INIT DATA ---
        const counterData = {};
        const allBrawlersSet = new Set();
        Object.keys(rawData).forEach(key => {
            const cleanKey = formatName(key);
            allBrawlersSet.add(cleanKey);
            const counters = rawData[key].map(val => {
                const cleanVal = formatName(val);
                allBrawlersSet.add(cleanVal);
                return cleanVal;
            });
            if(counterData[cleanKey]) counterData[cleanKey] = [...new Set([...(counterData[cleanKey]||[]), ...counters])];
            else counterData[cleanKey] = counters;
        });
        const allBrawlers = Array.from(allBrawlersSet).sort();
        
        // --- STATE ---
        let state = { 
            ban: [null,null,null,null,null,null], 
            enemy: [null,null,null], 
            ally: [null,null,null], 
            activeSlot: {type:null,index:null},
            firstPick: 'ally',
            ownedBrawlers: new Set(), // User Account Roster
            filterOwned: false        // Switch State
        };

        // ISOLATION STATE
        let isolatedOpponentIndex = null;

        // --- DOM ELEMENTS ---
        const activeGrid = document.getElementById('active-grid');
        const neutralGrid = document.getElementById('neutral-grid');
        const separator = document.getElementById('grid-separator');

        // --- LOGIC ---
        function getWeaknessesOf(brawlerName) {
            return counterData[brawlerName] || [];
        }

        // --- ROSTER LOGIC ---
        function initRoster() {
            const stored = localStorage.getItem('draft_owned_brawlers');
            if (stored) {
                state.ownedBrawlers = new Set(JSON.parse(stored));
            } else {
                // By default, own all
                state.ownedBrawlers = new Set(allBrawlers);
            }
            
            // Load filter state
            const filterState = localStorage.getItem('draft_filter_active');
            state.filterOwned = filterState === 'true';
            updateToggleUI();
        }

        function saveRoster() {
            localStorage.setItem('draft_owned_brawlers', JSON.stringify([...state.ownedBrawlers]));
        }

        function toggleOwnedFilter() {
            state.filterOwned = !state.filterOwned;
            localStorage.setItem('draft_filter_active', state.filterOwned);
            updateToggleUI();
            updateGridState(); 
            filterGrid(); // Re-apply search text if any
        }

        function updateToggleUI() {
            const container = document.querySelector('.toggle-container');
            if (state.filterOwned) container.classList.add('toggle-active');
            else container.classList.remove('toggle-active');
        }

        function openRosterModal() {
            const grid = document.getElementById('roster-grid');
            grid.innerHTML = '';
            
            allBrawlers.forEach(brawler => {
                const div = document.createElement('div');
                div.className = 'roster-item';
                if (state.ownedBrawlers.has(brawler)) div.classList.add('owned');
                
                div.onclick = () => {
                    if (state.ownedBrawlers.has(brawler)) state.ownedBrawlers.delete(brawler);
                    else state.ownedBrawlers.add(brawler);
                    
                    div.classList.toggle('owned');
                    saveRoster(); 
                };
                
                const fileName = getFileName(brawler);
                div.innerHTML = `<img src="icons/${fileName}">`;
                grid.appendChild(div);
            });
            
            document.getElementById('roster-modal').style.display = 'flex';
        }

        function closeRosterModal() {
            document.getElementById('roster-modal').style.display = 'none';
            updateGridState();
            filterGrid();
        }

        function selectAllRoster(all) {
            if (all) state.ownedBrawlers = new Set(allBrawlers);
            else state.ownedBrawlers = new Set();
            
            const items = document.getElementById('roster-grid').children;
            Array.from(items).forEach((div, idx) => {
                if(all) div.classList.add('owned');
                else div.classList.remove('owned');
            });
            saveRoster();
        }

        // --- INIT GRID ---
        function initGrid() {
            activeGrid.innerHTML = '';
            neutralGrid.innerHTML = '';
            
            allBrawlers.forEach(brawler => {
                const div = document.createElement('div');
                div.className = 'brawler-card';
                div.id = `card-${brawler.replace(/[\s.]/g, '-')}`; 
                div.dataset.name = brawler; 
                div.onclick = () => handleBrawlerClick(brawler);
                
                const fileName = getFileName(brawler);
                div.innerHTML = `
                    <img src="icons/${fileName}" onerror="this.onerror=null; this.src='https://via.placeholder.com/60?text=?'; this.parentElement.querySelector('.img-error-text').innerText = 'Missing: ${fileName}';">
                    <div class="name">${brawler}</div>
                    <div class="interactions-container">
                        <div class="mini-icon-group group-victims"></div>
                        <div class="mini-icon-group group-killers"></div>
                    </div>
                    <div class="img-error-text"></div>
                `;
                neutralGrid.appendChild(div);
            });
        }

        function selectSlot(element, type, index) {
            document.querySelectorAll('.ban-slot, .pick-slot').forEach(el => el.classList.remove('active'));
            state.activeSlot = { type, index };
            if(element) element.classList.add('active');
        }

        function toggleFirstPick() {
            state.firstPick = (state.firstPick === 'ally') ? 'enemy' : 'ally';
            const btn = document.getElementById('btn-fp');
            if (state.firstPick === 'ally') {
                btn.className = 'fp-ally';
                btn.innerText = '1À¢·µó pick : Me';
            } else {
                btn.className = 'fp-enemy';
                btn.innerText = '1À¢·µó pick : Them';
            }

            if (state.activeSlot.type !== 'ban') {
                const filledAlly = state.ally.filter(x => x !== null).length;
                const filledEnemy = state.enemy.filter(x => x !== null).length;
                const totalPicks = filledAlly + filledEnemy;

                if (totalPicks < 6) {
                    const A = state.firstPick;
                    const B = (A === 'ally') ? 'enemy' : 'ally';
                    const sequence = [
                        { type: A, index: 0 }, { type: B, index: 0 }, { type: B, index: 1 }, 
                        { type: A, index: 1 }, { type: A, index: 2 }, { type: B, index: 2 }
                    ];
                    const nextStep = sequence[totalPicks];
                    const panelIndex = (nextStep.type === 'enemy') ? 0 : 1;
                    const slotToSelect = document.querySelectorAll('.team-panel')[panelIndex]
                                                    .querySelectorAll('.pick-slot')[nextStep.index];
                    selectSlot(slotToSelect, nextStep.type, nextStep.index);
                }
            }
        }

        // ISOLATION TOGGLE
        function toggleIsolation(index, event) {
            if(event) event.stopPropagation();
            
            if (isolatedOpponentIndex === index) {
                isolatedOpponentIndex = null;
            } else {
                isolatedOpponentIndex = index;
            }
            
            // Visual update for eyes
            for(let i=0; i<3; i++) {
                const eye = document.getElementById(`eye-${i}`);
                if(eye) {
                    if(i === isolatedOpponentIndex) eye.classList.add('active-eye');
                    else eye.classList.remove('active-eye');
                }
            }
            
            updateGridState();
        }

        function handleBrawlerClick(brawlerName) {
            if (!state.activeSlot.type) { alert("Select a slot first!"); return; }
            const { type, index } = state.activeSlot;
            
            if (type !== 'ban' && isPickedOrBanned(brawlerName)) {
                if (state[type][index] !== brawlerName) return; 
            }
            
            state[type][index] = brawlerName;
            updateSlotUI(type, index, brawlerName);
            updateGridState();
            advanceToNextSlot(type, index);
        }

        function advanceToNextSlot(currentType, currentIndex) {
            if (currentType === 'ban') {
                if (currentIndex < 5) {
                    selectSlot(document.querySelectorAll('.ban-slot')[currentIndex + 1], 'ban', currentIndex + 1);
                } else {
                    const fpTeam = state.firstPick;
                    const panelIndex = (fpTeam === 'enemy') ? 0 : 1;
                    selectSlot(document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[0], fpTeam, 0);
                }
                return;
            }
            const A = state.firstPick;
            const B = (A === 'ally') ? 'enemy' : 'ally';
            const sequence = [
                { type: A, index: 0 }, { type: B, index: 0 }, { type: B, index: 1 }, 
                { type: A, index: 1 }, { type: A, index: 2 }, { type: B, index: 2 }
            ];
            let currentStepIndex = -1;
            for (let i = 0; i < sequence.length; i++) {
                if (sequence[i].type === currentType && sequence[i].index === currentIndex) {
                    currentStepIndex = i;
                    break;
                }
            }
            if (currentStepIndex !== -1 && currentStepIndex < sequence.length - 1) {
                const nextStep = sequence[currentStepIndex + 1];
                const panelIndex = (nextStep.type === 'enemy') ? 0 : 1;
                selectSlot(document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[nextStep.index], nextStep.type, nextStep.index);
            }
        }

        function isPickedOrBanned(name) {
            if (state.ban.includes(name)) return true;
            if (state.enemy.includes(name)) return true;
            if (state.ally.includes(name)) return true;
            return false;
        }

        function updateSlotUI(type, index, name) {
            const fileName = getFileName(name);
            let element;
            if (type === 'ban') {
                element = document.querySelectorAll('.ban-slot')[index];
                element.innerHTML = `<img src="icons/${fileName}" onerror="this.src='https://via.placeholder.com/60?text=${name.charAt(0)}'"><div class="ban-icon-overlay">X</div>`;
                element.classList.add('banned');
            } else {
                const panelIndex = type === 'enemy' ? 0 : 1;
                element = document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[index];
                
                // Add Eye if enemy
                let eyeHtml = '';
                if (type === 'enemy') {
                    const isActive = (isolatedOpponentIndex === index) ? 'active-eye' : '';
                    eyeHtml = `
                        <div id="eye-${index}" class="isolation-eye ${isActive}" onclick="toggleIsolation(${index}, event)">
                            <svg viewBox="0 0 24 24">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                    `;
                }

                element.innerHTML = `
                    <img src="icons/${fileName}" onerror="this.src='https://via.placeholder.com/100?text=?'">
                    <span>${name}</span>
                    <div class="slot-interactions">
                        <div class="slot-victims"></div>
                        <div class="slot-killers"></div>
                    </div>
                    ${eyeHtml}
                `;
            }
        }

        function updateGridState() {
            // FIX: Clean old breaks
            const oldBreaks = activeGrid.querySelectorAll('.grid-break');
            oldBreaks.forEach(b => b.remove());

            const allEnemies = state.enemy.filter(e => e);
            
            // Isolation Logic
            let enemiesToCalculate = allEnemies;
            if (isolatedOpponentIndex !== null && state.enemy[isolatedOpponentIndex]) {
                enemiesToCalculate = [state.enemy[isolatedOpponentIndex]];
            }

            // Flag for explicit isolation
            const isExplicitlyIsolated = (isolatedOpponentIndex !== null);

            const activeAllies = state.ally.filter(a => a);

            // 1. UPDATE SLOTS
            const updatePickSlots = (teamArr, type) => {
                const panelIndex = (type === 'enemy') ? 0 : 1;
                const panel = document.querySelectorAll('.team-panel')[panelIndex];
                const opposingTeam = (type === 'enemy') ? activeAllies : allEnemies;

                teamArr.forEach((brawler, idx) => {
                    if(!brawler) return;
                    const slot = panel.querySelectorAll('.pick-slot')[idx];
                    const vCont = slot.querySelector('.slot-victims');
                    const kCont = slot.querySelector('.slot-killers');
                    if(!vCont) return;

                    vCont.innerHTML = '';
                    kCont.innerHTML = '';

                    opposingTeam.forEach(other => {
                        if (getWeaknessesOf(other).includes(brawler)) {
                            const img = document.createElement('img');
                            img.src = "icons/" + getFileName(other);
                            img.className = "slot-mini-icon victim";
                            vCont.appendChild(img);
                        }
                        if (getWeaknessesOf(brawler).includes(other)) {
                            const img = document.createElement('img');
                            img.src = "icons/" + getFileName(other);
                            img.className = "slot-mini-icon killer";
                            kCont.appendChild(img);
                        }
                    });
                });
            };
            
            updatePickSlots(state.enemy, 'enemy');
            updatePickSlots(state.ally, 'ally');

            // 2. UPDATE GRID SUGGESTIONS
            let activeCards = [];
            let neutralCards = [];

            allBrawlers.forEach(brawler => {
                // --- OWNED FILTER ---
                const card = document.getElementById(`card-${brawler.replace(/[\s.]/g, '-')}`);
                if (!card) return;

                if (state.filterOwned && !state.ownedBrawlers.has(brawler)) {
                    card.style.display = 'none';
                    return; 
                }
                card.style.display = 'flex'; // Reset display if previously hidden
                // ---------------------------
                
                card.className = 'brawler-card'; 
                card.classList.remove('expanded');
                
                const victimsContainer = card.querySelector('.group-victims');
                const killersContainer = card.querySelector('.group-killers');
                victimsContainer.innerHTML = '';
                killersContainer.innerHTML = '';

                let statusPriority = 999; 
                let isRelevant = false;

                if (state.ban.includes(brawler)) {
                    card.classList.add('disabled', 'banned');
                    neutralCards.push({ card, priority: 1000, name: brawler });
                    return;
                } else if (allEnemies.includes(brawler) || activeAllies.includes(brawler)) {
                    card.classList.add('disabled');
                    neutralCards.push({ card, priority: 1000, name: brawler });
                    return;
                }

                let victims = []; 
                let killers = []; 

                enemiesToCalculate.forEach(enemy => {
                    if (getWeaknessesOf(enemy).includes(brawler)) { victims.push(enemy); }
                    if (getWeaknessesOf(brawler).includes(enemy)) { killers.push(enemy); }
                });

                victims.forEach(vName => {
                    const img = document.createElement('img'); img.src = "icons/" + getFileName(vName);
                    img.className = "mini-icon victim"; victimsContainer.appendChild(img);
                });
                killers.forEach(kName => {
                    const img = document.createElement('img'); img.src = "icons/" + getFileName(kName);
                    img.className = "mini-icon killer"; killersContainer.appendChild(img);
                });

                const scoreNet = victims.length - killers.length;
                const threats = killers.length;
                const maxThreats = enemiesToCalculate.length; 
                
                if (victims.length > 0 || killers.length > 0) {
                    isRelevant = true;
                    card.classList.add('expanded');
                }

                if (threats === 0) {
                    const isPerfectGlobal = (!isExplicitlyIsolated && victims.length === 3);
                    const isPerfectIsolated = (isExplicitlyIsolated && victims.length === 1);

                    if (isPerfectGlobal || isPerfectIsolated) {
                        card.classList.add('status-perfect'); statusPriority = 1; // Cyan
                    } else if (scoreNet >= 2) {
                        card.classList.add('status-ideal'); statusPriority = 2; // Gold
                    } else if (scoreNet > 0) {
                        card.classList.add('status-good'); statusPriority = 3; // Green
                    } else {
                        if(isRelevant) statusPriority = 5; 
                    }
                } else {
                    if (maxThreats > 0 && threats === maxThreats) {
                        card.classList.add('status-worst'); statusPriority = 8;
                    } else if (scoreNet > 0) {
                        card.classList.add('status-good-risky'); statusPriority = 4;
                    } else if (scoreNet === 0) {
                        card.classList.add('status-mixed'); statusPriority = 5;
                    } else if (scoreNet === -1) {
                        card.classList.add('status-bad'); statusPriority = 6;
                    } else {
                        card.classList.add('status-fatal'); statusPriority = 7;
                    }
                }

                if (isRelevant) {
                    activeCards.push({ card, priority: statusPriority, name: brawler });
                } else {
                    neutralCards.push({ card, priority: 999, name: brawler });
                }
            });

            activeCards.sort((a, b) => {
                if (a.priority !== b.priority) return a.priority - b.priority;
                return a.name.localeCompare(b.name);
            });

            neutralCards.sort((a, b) => a.name.localeCompare(b.name));

            let hasInsertedBreak = false;
            activeCards.forEach((item, index) => {
                if (!hasInsertedBreak && item.priority >= 6) {
                    if (index > 0) {
                         const breakDiv = document.createElement('div');
                         breakDiv.className = 'grid-break';
                         activeGrid.appendChild(breakDiv);
                    }
                    hasInsertedBreak = true;
                }
                activeGrid.appendChild(item.card);
            });

            neutralCards.forEach(item => neutralGrid.appendChild(item.card));
            separator.style.display = activeCards.length > 0 ? 'block' : 'none';
            
            // Re-apply search filter if needed
            filterGrid();
        }

        function filterGrid() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const clearBtn = document.getElementById('searchClear');
            clearBtn.style.display = term.length > 0 ? 'block' : 'none';

            const cards = document.querySelectorAll('.brawler-card');
            cards.forEach(card => {
                // If already hidden by roster filter, don't show it
                if (card.style.display === 'none' && (!state.filterOwned || !state.ownedBrawlers.has(card.dataset.name))) return;

                const name = card.querySelector('.name').innerText.toLowerCase();
                card.style.display = name.includes(term) ? 'flex' : 'none';
            });
        }

        function clearSearch() {
            const input = document.getElementById('searchInput');
            input.value = '';
            input.focus();
            filterGrid();
        }

        function clearCurrentSlot() {
            const { type, index } = state.activeSlot;
            if (!type) return;

            // If clearing isolated slot, remove isolation
            if (type === 'enemy' && index === isolatedOpponentIndex) {
                isolatedOpponentIndex = null;
            }

            state[type][index] = null;
            clearSlot(type, index);
            updateGridState();
        }

        function clearSlot(type, index) {
             if (type === 'ban') {
                const el = document.querySelectorAll('.ban-slot')[index];
                el.innerHTML = ''; el.classList.remove('banned');
            } else {
                const panelIndex = type === 'enemy' ? 0 : 1;
                const el = document.querySelectorAll('.team-panel')[panelIndex].querySelectorAll('.pick-slot')[index];
                el.innerHTML = `<span>Pick ${index+1}</span>`;
            }
        }

        function resetDraft() {
            if(!confirm("Reset everything?")) return;
            state.ban = [null,null,null,null,null,null];
            state.enemy = [null,null,null];
            state.ally = [null,null,null];
            
            isolatedOpponentIndex = null;

            document.querySelectorAll('.ban-slot').forEach(el => { el.innerHTML = ''; el.classList.remove('banned'); });
            document.querySelectorAll('.pick-slot').forEach((el, i) => {
                const idx = Array.from(el.parentNode.children).indexOf(el) - 1; 
                el.innerHTML = `<span>Pick ${idx + 1}</span>`;
            });
            state.firstPick = 'ally';
            const btn = document.getElementById('btn-fp');
            btn.className = 'fp-ally';
            btn.innerText = '1À¢·µó pick : Me';
            updateGridState();
            document.getElementById('searchInput').value = '';
            filterGrid();
            setTimeout(() => { selectSlot(document.querySelectorAll('.ban-slot')[0], 'ban', 0); }, 50);
        }

        document.addEventListener('keydown', function(e) {
            const searchInput = document.getElementById('searchInput');
            if (document.activeElement === searchInput) {
                if (e.key === 'Escape') searchInput.blur();
                return;
            }
            if (e.key === 'Backspace') {
                searchInput.value = ''; searchInput.focus(); filterGrid(); return;
            }
            if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
                searchInput.value = ''; searchInput.focus();
            }
            else if ((e.ctrlKey || e.metaKey) && (e.key === 'f' || e.key === 'F')) {
                e.preventDefault(); searchInput.value = ''; searchInput.focus(); filterGrid(); 
            }
        });

        // Initialize everything
        initRoster(); 
        initGrid();
        selectSlot(document.querySelectorAll('.ban-slot')[0], 'ban', 0);

    </script>
</body>
</html>